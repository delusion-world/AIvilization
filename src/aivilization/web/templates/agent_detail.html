{% extends "base.html" %}

{% block title %}{{ agent.state.name }} â€” AIvilization{% endblock %}

{% block content %}
<a href="/" class="back-link">&larr; Back to Dashboard</a>

<h1>{{ agent.state.name }}</h1>
<p class="subtitle">{{ agent.state.role }}</p>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ agent.state.status.value }}</div>
        <div class="stat-label">Status</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ agent.state.total_api_calls }}</div>
        <div class="stat-label">API Calls</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ agent.state.total_tools_created }}</div>
        <div class="stat-label">Tools Created</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ agent.state.total_agents_created }}</div>
        <div class="stat-label">Agents Created</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ agent.state.depth }}</div>
        <div class="stat-label">Depth</div>
    </div>
</div>

<section class="section">
    <h2>System Prompt</h2>
    <pre class="code-block">{{ agent.state.system_prompt_base }}</pre>
</section>

{% if memory.knowledge %}
<section class="section">
    <h2>Knowledge</h2>
    <table class="data-table">
        <thead>
            <tr><th>Key</th><th>Value</th></tr>
        </thead>
        <tbody>
            {% for key, value in memory.knowledge.items() %}
            <tr><td><strong>{{ key }}</strong></td><td>{{ value }}</td></tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endif %}

{% if memory.episodic_memories %}
<section class="section">
    <h2>Memories</h2>
    <div class="activity-log">
        {% for mem in memory.episodic_memories | reverse %}
        <div class="activity-item">
            <span class="activity-type">importance: {{ "%.1f" % mem.importance }}</span>
            <span class="activity-data">{{ mem.summary }}</span>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{% if memory.role_notes %}
<section class="section">
    <h2>Role Evolution</h2>
    <ul>
        {% for note in memory.role_notes %}
        <li>{{ note }}</li>
        {% endfor %}
    </ul>
</section>
{% endif %}

{% if alliances %}
<section class="section">
    <h2>Alliances</h2>
    {% for alliance in alliances %}
    <div class="card">
        <h3>{{ alliance.name }}</h3>
        <p>{{ alliance.purpose }}</p>
    </div>
    {% endfor %}
</section>
{% endif %}

<section class="section">
    <h2>Details</h2>
    <table class="data-table">
        <tbody>
            <tr><td><strong>ID</strong></td><td>{{ agent.id }}</td></tr>
            <tr><td><strong>Created</strong></td><td>{{ agent.state.created_at }}</td></tr>
            <tr><td><strong>Created By</strong></td><td>{{ agent.state.created_by or "User" }}</td></tr>
            <tr><td><strong>Total Tokens</strong></td><td>{{ "{:,}".format(agent.state.total_tokens_used) }}</td></tr>
        </tbody>
    </table>
</section>
{% endblock %}
